#set( $symbol_pound = '#' )
#set( $symbol_dollar = '$' )
#set( $symbol_escape = '\' )
${symbol_pound}!/bin/sh
${symbol_pound}${symbol_pound} Date: 25/11/2013
${symbol_pound}${symbol_pound} Auteur: IDEI080 (CSNT)
${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound} Description:
${symbol_pound}${symbol_pound}    Lancement du batch ${artifactId}
${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound} Frequence:
${symbol_pound}${symbol_pound}    MENSUELLE
${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound} Modifications :
${symbol_pound}${symbol_pound}      JJ.MM.AAAA par XXX
${symbol_pound}${symbol_pound}      Nature de la modification
${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}

${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}
${symbol_pound}${symbol_pound} Variables Ã  positionner prealablement au lancement du script en
${symbol_pound}${symbol_pound} fonction de l'environnement cible:
${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}${symbol_pound}
${symbol_pound}export DB_SCHEMA=EJRA01A
${symbol_pound}export DB_URL=vipalp21.si2m.tec
${symbol_pound}export DB_PORT=22446
${symbol_pound}export DB_NAME=E2D3
${symbol_pound}export DB_USER=SEJRRP00
${symbol_pound}export DB_PWD=7CA2D3F9

export PROJECT_NAME=${symbol_dollar}{project.name}
export CHAINE_EXP=${symbol_dollar}{chaine.exp}
export LOGBACK_CONF=/appli/${symbol_dollar}{USER}/batch/etc/${symbol_dollar}{PROJECT_NAME}_logback.xml

REPFIL=/appli/${symbol_dollar}{USER}/batch/${symbol_dollar}{CHAINE_EXP}/file

FICHIER=${symbol_dollar}{REPFIL}/${symbol_dollar}{PROJECT_NAME}
if [ -f ${symbol_dollar}{FICHIER}.properties ]
then
	echo "Le fichier ${symbol_dollar}{FICHIER}.properties existe deja, on est donc dans un cas de reprise"
else
	if [ -f ${symbol_dollar}{FICHIER}.ini ]
	then
		sed -r -e "s/${symbol_escape}"/${symbol_escape}${symbol_escape}${symbol_escape}${symbol_escape}${symbol_escape}"/g" -e "s/.*/echo ${symbol_escape}"${symbol_escape}0${symbol_escape}"/g" ${symbol_dollar}{FICHIER}.ini | bash > ${symbol_dollar}{FICHIER}.properties
	else
		echo "Le fichier ${symbol_dollar}{FICHIER}.ini n'est pas present']"
	fi
fi

FICHIER=${symbol_dollar}{REPFIL}/hibernate
if [ -f ${symbol_dollar}{FICHIER}.properties ]
then
	echo "Le fichier ${symbol_dollar}{FICHIER}.properties existe deja, on est donc dans un cas de reprise"
else
	if [ -f ${symbol_dollar}{FICHIER}.ini ]
	then
		sed -r -e "s/${symbol_escape}"/${symbol_escape}${symbol_escape}${symbol_escape}${symbol_escape}${symbol_escape}"/g" -e "s/.*/echo ${symbol_escape}"${symbol_escape}0${symbol_escape}"/g" ${symbol_dollar}{FICHIER}.ini | bash > ${symbol_dollar}{FICHIER}.properties
	else
		echo "Le fichier ${symbol_dollar}{FICHIER}.ini n'est pas present']"
	fi
fi

echo "Ligne de lancement: 'java -Xms128m -Xmx512m -Xbootclasspath/a:${symbol_dollar}{REPFIL} -jar /appli/${symbol_dollar}{USER}/batch/script/${symbol_dollar}{PROJECT_NAME}.jar ${symbol_dollar}{REPFIL}/${symbol_dollar}{PROJECT_NAME}.properties'"
java -Xms128m -Xmx512m -Xbootclasspath/a:${symbol_dollar}{REPFIL} -jar /appli/${symbol_dollar}{USER}/batch/script/${symbol_dollar}{PROJECT_NAME}.jar ${symbol_dollar}{REPFIL}/${symbol_dollar}{PROJECT_NAME}.properties
CR=${symbol_dollar}?
echo ${symbol_dollar}CR

${symbol_pound}-------------------------------------------------------------------
${symbol_pound}. debut_trt ${symbol_dollar}(basename ${symbol_dollar}0) ${symbol_dollar}*   ${symbol_pound} Utilitaire technique de debut
${symbol_pound}----------------Debut du script applicatif-------------------------
${symbol_pound}set -x

${symbol_pound}FICHIER=${symbol_dollar}REPFIL/${artifactId}
${symbol_pound}if [ -f ${symbol_dollar}{FICHIER}.properties ]
${symbol_pound}then
${symbol_pound}   echo "Le fichier ${symbol_dollar}{FICHIER}.properties existe deja, on est donc dans un cas de reprise"
${symbol_pound}else
${symbol_pound}    if [ -f ${symbol_dollar}{FICHIER}.ini ]
${symbol_pound}    then
${symbol_pound}        ${symbol_pound}-- On remplace les variables d'environnement dans le fichier par leur valeur
${symbol_pound}        while read ligne
${symbol_pound}            do echo -e ${symbol_dollar}(eval echo ${symbol_dollar}ligne)
${symbol_pound}        done <${symbol_dollar}{FICHIER}.ini > ${symbol_dollar}{FICHIER}.properties
${symbol_pound}     else
${symbol_pound}        echo "Pas de fichier ${symbol_dollar}{FICHIER}.ini a implementer avec les variables d'environnement"
${symbol_pound}        CR=101
${symbol_pound}    fi
${symbol_pound}fi

${symbol_pound}FICHIER=${symbol_dollar}REPFIL/hibernate
${symbol_pound}if [ -f ${symbol_dollar}{FICHIER}.properties ]
${symbol_pound}then
${symbol_pound}   echo "Le fichier ${symbol_dollar}{FICHIER}.properties existe deja, on est donc dans un cas de reprise"
${symbol_pound}else
${symbol_pound}    if [ -f ${symbol_dollar}{FICHIER}.ini ]
${symbol_pound}    then
${symbol_pound}        ${symbol_pound}-- On remplace les variables d'environnement dans le fichier par leur valeur
${symbol_pound}        while read ligne
${symbol_pound}            do echo -e ${symbol_dollar}(eval echo ${symbol_dollar}ligne)
${symbol_pound}        done <${symbol_dollar}{FICHIER}.ini > ${symbol_dollar}{FICHIER}.properties
${symbol_pound}     else
${symbol_pound}        echo "Pas de fichier ${symbol_dollar}{FICHIER}.ini a implementer avec les variables d'environnement"
${symbol_pound}        CR=101
${symbol_pound}    fi
${symbol_pound}fi
${symbol_pound}-- (
${symbol_pound}-- cd ${symbol_dollar}REPSCRIPT &&
${symbol_pound}-- java -Xms128m -Xmx512m -jar ../../script/${symbol_dollar}{PROJECT_NAME}.jar ${symbol_dollar}{REPFIL}/${symbol_dollar}{PROJECT_NAME}.properties
${symbol_pound}-- )
${symbol_pound}CR=${symbol_dollar}?
${symbol_pound}echo ${symbol_dollar}CR

${symbol_pound}-----------------Fin du script applicatif--------------------------
${symbol_pound}. fin_trt ${symbol_dollar}CR                   ${symbol_pound} Utilitaire technique de fin
${symbol_pound}-------------------------------------------------------------------